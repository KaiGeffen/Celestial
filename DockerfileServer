FROM node:18

# Create app directory
WORKDIR /home/node/app

# Copy everything at once
COPY . .

# Install dependencies globally to avoid permission issues
RUN npm install -g npm@10.8.2

# Switch to specific npm version that works locally
RUN npm --version

# Install dependencies with verbose logging to see where it fails
RUN npm install --verbose

RUN npm run build:server

CMD [ "npm", "run", "start:server" ]